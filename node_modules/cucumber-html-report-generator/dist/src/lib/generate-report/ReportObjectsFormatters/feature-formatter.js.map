{"version":3,"file":"feature-formatter.js","sourceRoot":"","sources":["../../../../../src/lib/generate-report/ReportObjectsFormatters/feature-formatter.ts"],"names":[],"mappings":"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","sourcesContent":["import * as CommonFunctions from '../../common-functions/common-functions';\nimport * as Models from '../../models/models';\nimport { ScenarioFormatter } from './scenario-formatter';\nimport type { messages } from 'cucumber-messages';\n\nexport class FeatureFormatter {\n  private readonly gherkinFeature: messages.GherkinDocument.IFeature | null | undefined ;\n  private jsonFeature: Models.Feature;\n  private readonly scenarioFormater: ScenarioFormatter;\n  private readonly scenarioOutlines: Models.ScenarioOutline[];\n\n  public constructor ( gherkinFeature: messages.GherkinDocument.IFeature | null | undefined, jsonFeature: Models.Feature ) {\n    this.gherkinFeature = gherkinFeature;\n    this.jsonFeature = jsonFeature;    \n    this.scenarioFormater = new ScenarioFormatter( this.gherkinFeature );\n    this.scenarioOutlines = this.getOutlineScenarios();\n  }\n\n  public parseFeature (): Models.Feature {\n    this.initalizeFeature( );\n\n    if( this.jsonFeature.elements?.length ){\n      this.joinOutlineScenarios();\n      for( let index = 0; index < this.jsonFeature.elements.length; index++ ) {\n        const jsonScenario = this.scenarioFormater.parseScenario( this.jsonFeature.elements[index], this.jsonFeature.name );\n        if( jsonScenario !== null && typeof jsonScenario !== 'undefined' ){\n          this.jsonFeature.elements[index] = jsonScenario;\n          this.updateFeatureStadistics( this.jsonFeature.elements[index]?.results );\n          if( this.isLastScenarioOutlineWithFeature( jsonScenario, index ) ){\n            const scenarios = this.addFirstScenarioOutline( this.jsonFeature.elements, jsonScenario, index );\n            this.jsonFeature.elements = scenarios;\n            index++;\n          }\n        }\n      }\n      \n      this.jsonFeature.results.overview.durationHHMMSS =\n      CommonFunctions.convertTimeFromNanoSecondsToHHMMSS( this.jsonFeature.results.overview.duration );\n      this.jsonFeature.elements = this.jsonFeature.elements.filter( scenario => Object.keys( scenario ).length && scenario.steps?.length );\n    }\n\n    return this.jsonFeature;\n  }\n\n  private addFirstScenarioOutline( scenarios: Models.Scenario[], jsonScenario: Models.Scenario, index: number ): Models.Scenario[]{\n    const scenarioName = jsonScenario.name;\n    const gherkinScenario = this.gherkinFeature?.children?.filter(\n      scenario => scenario.scenario?.name === scenarioName )[0]?.scenario;\n    const scenarioOutlineLengthWithoutHeaders = this.scenarioOutlines.filter( scenario => scenario.name === scenarioName ).length - 1;\n    const scenarioOutline = this.scenarioFormater.createNewFirstScenarioOutline( jsonScenario, gherkinScenario, scenarios, index - scenarioOutlineLengthWithoutHeaders );\n    scenarios.splice( index - scenarioOutlineLengthWithoutHeaders, 0, scenarioOutline );\n\n    return scenarios;\n  }\n\n  private updateFeatureStadistics( scenarioResults: Models.ScenarioResults ): void{\n    this.jsonFeature.results.scenarios.undefined += scenarioResults.steps.undefined ? 1 : 0;\n    this.jsonFeature.results.scenarios.failed += !scenarioResults.steps.undefined && scenarioResults.steps.failed ? 1 : 0;\n    this.jsonFeature.results.scenarios.ambiguous += scenarioResults.steps.ambiguous &&\n                  !scenarioResults.steps.undefined &&\n                  !scenarioResults.steps.failed ? 1 : 0;\n    this.jsonFeature.results.scenarios.pending += scenarioResults.steps.pending &&\n                  !scenarioResults.steps.failed &&\n                  !scenarioResults.steps.ambiguous &&\n                  !scenarioResults.steps.undefined ? 1 : 0;\n    this.jsonFeature.results.scenarios.skipped += scenarioResults.steps.skipped &&\n                  !scenarioResults.steps.failed &&\n                  !scenarioResults.steps.ambiguous &&\n                  !scenarioResults.steps.pending &&\n                  !scenarioResults.steps.undefined ? 1 : 0;\n    this.jsonFeature.results.scenarios.passed += \n                  scenarioResults.steps.passed &&\n                  !scenarioResults.steps.failed &&\n                  !scenarioResults.steps.skipped &&\n                  !scenarioResults.steps.pending &&\n                  !scenarioResults.steps.ambiguous &&\n                  !scenarioResults.steps.undefined ? 1 : 0;\n    this.jsonFeature.results.scenarios.total =\n                  this.jsonFeature.results.scenarios.passed +\n                  this.jsonFeature.results.scenarios.skipped +\n                  this.jsonFeature.results.scenarios.pending +\n                  this.jsonFeature.results.scenarios.undefined +\n                  this.jsonFeature.results.scenarios.ambiguous +\n                  this.jsonFeature.results.scenarios.failed;\n    this.jsonFeature.results.scenarios = CommonFunctions.updatePercentages( this.jsonFeature.results.scenarios );                  \n    this.jsonFeature.results.steps = CommonFunctions.updateResultsAndPercentages( this.jsonFeature.results.steps,scenarioResults.steps );\n    this.jsonFeature.results.overview.result = CommonFunctions.updateStatus( this.jsonFeature.results );\n    this.jsonFeature.results.overview.duration += scenarioResults.overview.duration;\n  }\n\n  private initalizeFeature(  ): void{\n    this.jsonFeature.description = typeof this.jsonFeature.description === 'undefined' ? '' : this.jsonFeature.description;\n    this.jsonFeature.elements = this.jsonFeature.elements === null || typeof this.jsonFeature.elements === 'undefined' ? [] : this.jsonFeature.elements;\n    this.jsonFeature.results = Models.featureResultsInitializer();\n    this.jsonFeature.tags = typeof this.jsonFeature.tags === 'undefined' ? [] : this.jsonFeature.tags;\n    this.jsonFeature.metadataTitle = this.jsonFeature.metadataTitle ?? 'Custom Data';\n    this.jsonFeature.metadata = CommonFunctions.isMetadata( this.jsonFeature.metadata ) ? this.jsonFeature.metadata : [];\n    this.jsonFeature.line = this.jsonFeature.line ?? 0;\n    this.joinOutlineScenarios();\n  }\n\n  private joinOutlineScenarios(): void{\n    const scenarioOutlines: {\n      index: number;\n      name: string;\n    }[] = [];\n    this.jsonFeature.elements?.forEach( scenario => {\n      if ( this.scenarioFormater.isOutlineScenario( scenario ) ){\n        scenarioOutlines.push( { index: parseInt( `${( this.jsonFeature.elements! ).indexOf( scenario )}`, 10 ),\n                                 name: `${scenario.name}` } );\n      }\n    } );\n    const scenarioOutlineNames = [ ...new Set( scenarioOutlines.map( item => item.name ) ) ];\n    scenarioOutlineNames.forEach( name =>{\n      const scenarioOutlineElements = scenarioOutlines.filter( scenario => scenario.name === name );\n      const firstScenarioIndex = scenarioOutlineElements[0].index;\n      scenarioOutlineElements.forEach( ( scenarioOutlineElement, index ) =>{\n        CommonFunctions.arraymove( this.jsonFeature.elements!,scenarioOutlineElement.index, firstScenarioIndex + index );\n      } );\n    } );\n  }\n\n  private isLastScenarioOutlineWithFeature( scenario: Models.Scenario, index: number ): boolean{\n    const ocurrences = this.scenarioOutlines.filter( scenarioElement => scenarioElement.name === scenario.name );\n    if( ocurrences[ocurrences.length - 1]?.index === index ){\n      return true;\n    }\n    return false;\n  }\n\n  private getOutlineScenarios(): Models.ScenarioOutline[]{\n    const scenarioOutlines: Models.ScenarioOutline[] = [];\n    this.jsonFeature.elements?.forEach( scenario => {\n      if ( this.scenarioFormater.isOutlineScenario( scenario ) ){\n        scenarioOutlines.push( { index: parseInt( `${( this.jsonFeature.elements! ).indexOf( scenario )}`, 10 ),\n                                 name: `${scenario.name}` } );\n      }\n    } );\n    \n    return scenarioOutlines;\n  }\n}\n"]}